name: User Command Workflow

on:
  issue_comment:
    types: [created]

jobs:
  handle-command:
    if: contains(github.event.comment.body, '/')
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    - name: Use Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20.x'
        cache: 'npm'
        cache-dependency-path: dapp-ui/package-lock.json
    - name: Handle command
      run: |
        COMMAND=$(echo "${{ github.event.comment.body }}" | grep -o '/[a-zA-Z]*' | head -1)
        case $COMMAND in
          /test)
            cd dapp-ui && npm ci && npm test
            ;;
          /build)
            cd dapp-ui && npm ci && npm run build
            ;;
          /compile)
            npm install -g tronbox && tronbox compile
            ;;
          *)
            echo "Unknown command: $COMMAND"
            ;;
        esac
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}